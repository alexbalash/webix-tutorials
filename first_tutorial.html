<!doctype html>

<head>
	<meta charset="utf-8">
	<title> Test DataTable</title>
	<script type="text/javascript" src="http://cdn.webix.com/edge/webix.js"></script>
	<link rel="stylesheet" type="text/css" href="http://cdn.webix.com/edge/webix.css">

	<style type="text/css">
		.webix_list_item {
			border: 0px;
		}

		.webix_list {
			background-color: #f4f5f9;
		}

		.webix_template {
			text-align: center;
		}

		.header-like {
			background-color: #f4f5f9
		}

		.myhover {
			background: #F0DCB6;
		}

		.green {
			background-color: #76e485
		}

		.webix_list_item .webix_icon {
			float: right;
		}
	</style>
</head>

<body>
	<div id="test"></div>
	<script type="text/javascript" charset="utf-8">
		let menu = [
			{ id: "Dashboard", title: "Dashboard" },
			{ id: "Dashboard1", title: "Dashboard1" },
			{ id: "Users", title: "Users" },
			{ id: "Products", title: "Products" },
			{ id: "Admin", title: "Admin" },
		];

		let films_dataset = [
			{ id: 1, title: "The Shawshank Redemption", year: 1994, votes: 678790, rating: 9.2, rank: 1 },
			{ id: 2, title: "The Godfather", year: 1972, votes: 511495, rating: 9.2, rank: 2 },
			{ id: 3, title: "The Godfather: Part II", year: 1974, votes: 319352, rating: 9.0, rank: 3 },
			{ id: 4, title: "The Good, the Bad and the Ugly", year: 1966, votes: 213030, rating: 8.9, rank: 4 },
			{ id: 5, title: "My Fair Lady", year: 1964, votes: 533848, rating: 8.9, rank: 5 },
			{ id: 6, title: "12 Angry Men", year: 1957, votes: 164558, rating: 8.9, rank: 6 }
		];

		const popup_data = [
			{ id: 1, title: "Settings" },
			{ id: 2, title: "Log Out" }
		];


		const popup = webix.ui({
			view: "popup",
			id: "popup",
			body: {
				view: "list",
				data: popup_data,
				autoheight: true,
				autowidth: true,
				template: "#title#"
			}
		});

		const form_full = {
			view: "form",
			id: "film_form",
			gravity: 1,
			rules: {
				title: webix.rules.isNotEmpty,
				year: function (value) {
					return (value >= 1970 && value <= 2021);
				},
				votes: function (value) {
					return value < 100000
				},
				rating: function (value) {
					return !(value == '' || value == 0);

				}
			},

			elements: [
				{
					margin: 20, rows: [{ template: "Edit films", type: "section" },
					{ view: "text", name: "title", id: "inp_title", label: "Title", invalidMessage: "Title can`t be empty" },
					{ view: "text", name: "year", id: "inp_year", label: "Year", invalidMessage: "Enter year between 1970 and 2021" },
					{ view: "text", name: "rating", id: "inp_ratings", label: "Ratings", invalidMessage: "Cannot be empty or 0" },
					{ view: "text", name: "votes", id: "inp_votes", label: "Votes", invalidMessage: "Must be less than 100000" },
					{}]
				},
				{
					margin: 20, cols: [
						{
							view: "button", value: "Add new", css: "webix_primary", height: 40, click: function () {
								const form = $$("film_form");
								const result = form.validate();
								if (result) {
									const item_data = form.getValues();
									$$("films").add(item_data);
									webix.message("Successfully saved");
								}
							}
						},
						{
							view: "button", value: "Clear", height: 40, click: function () {
								webix.confirm("Are you sure to clean the form?", "confirm-warning").then(function () {
									const form = $$("film_form");
									form.clearValidation();
									form.clear();
								})

							}
						}
					]
				},


			]
		};

		const datatable = {
			view: "datatable",
			id: "films",
			data: films_dataset,
			autoConfig: true,
			gravity: 3
		};
		const toolbar = {
			padding: 10,
			view: "toolbar",
			css: "webix_dark",
			elements: [
				{ view: "label", label: "My App", gravity: 10 },
				{ view: "icon", icon: "wxi-user" },
				{
					view: "button", value: "Profile", gravity: 1, css: "webix_transparent", autowidth: true, click: function () {
						popup.show(this.$view);
					}
				},

			]

		};
		const list = {
			view: "list",
			id: "menu1",
			data: menu,
			template: "#title#",
			select: true,
			width: 250,
			on: {
				onAfterSelect: function (id) {
					$$(id).show();
				}
			},
		};
		const footer = {
			view: "template", template: "The software is provided by <a href=\"https://webix.com\">https://webix.com</a>. All rights reserved (c) ", autoheight: true
		};

		const userDatatable = {
			view: "datatable",
			id: "userDatatable",
			url: "data.js",
			hover: "myhover",
			columns: [
				{ id: "id", header: "", width: 50, css: "header-like" },
				{ id: "title", header: ["Film title", { content: "textFilter" }], fillspace: true, sort: "string", minWidth: 500 },
				{ id: "year", header: ["Year", { content: "numberFilter" }], sort: "int" },
				{ id: "votes", header: ["Votes", { content: "numberFilter" }], sort: "int" },
				{ id: "rating", header: ["Rating", { content: "numberFilter" }], sort: "int" },
				{ id: "rank", header: ["Rank", { content: "numberFilter" }], sort: "int" },
				{ id: "del", template: "{common.trashIcon()}" }],
			onClick: {
				"wxi-trash": function (e, id) {
					this.remove(id);
					return false;
				}
			},
			gravity: 2,
		};
		const userForm = {
			view: "form",
			id: "user_form",
			rows: [
				{ view: "text", name: "title", id: "user_title", label: "Film Title" },
				{ view: "text", name: "year", id: "user_year", label: "Released" },
				{ view: "text", name: "votes", id: "user_votes", label: "Votes" },
				{ view: "button", id: "btn_save", value: "Save", click: saveItem },
				{ view: "button", id: "btn_clear", value: "Clear", click: function () { $$("user_form").clear() } },
				{}
			],
			gravity: 1
		};

		function saveItem() {
			const form = $$("user_form");
			const table = $$("userDatatable");
			const item_data = form.getValues();
			if (item_data.id) {
				table.updateItem(item_data.id, item_data);
			} else {
				table.add(item_data);
			}
		};

		const userList = {
			view: "list",
			id: "userList",
			url: "users.js",
			template: obj => {
				const ind = $$("userList").getIndexById(obj.id);
				return `<div class="${ind < 5 ? "green" : ""}">${obj.name} from ${obj.country} <span class='webix_icon wxi-close'></span></div>`;
			},
			select: true,
			onClick: {
				webix_icon: function (e, id) {
					this.remove(id);
					return false;
				}
			},

		};

		const chart = {
			view: "chart",
			type: "bar",
			value: "#age#",
			border: true,
			xAxis: {
				template: "#age#",
				title: "Age"
			},
			url: "users.js"
		};

		const filter = {
			view: "toolbar",
			elements: [
				{ view: "text", id: "list_input" },
				{
					view: "button", id: "sort_asc", css: "webix_primary", value: "Sort asc", maxWidth: 200, click: function () {
						$$("userList").sort({
							by: "#name#",
							dir: "asc",
							as: "string"
						});
					}
				},
				{
					view: "button", id: "sort_desc", css: "webix_primary", value: "Sort desc", maxWidth: 200, click: function () {
						$$("userList").sort({
							by: "#name#",
							dir: "desc",
							as: "string"
						});
					}
				}
			],
		};

		const treetable = {
			view: "treetable",
			id: "treetable",
			select: "cell",
			columns: [
				{
					id: "id",
					header: "",
					width: 60
				},
				{
					id: "title",
					header: "Title",
					template: "{common.treetable()} #title#",
					width: 200
				},
				{
					id: "price",
					header: "Price",
					width: 200
				}
			],
			url: "products.js",
			on: {
				onAfterLoad: function () {
					$$("treetable").openAll();
				}
			},
		};

		let main = {
			cells: [
				{ id: "Dashboard", cols: [datatable, form_full] },
				{ id: "Dashboard1", cols: [userForm, userDatatable] },
				{ id: "Users", rows: [filter, userList, chart] },
				{ id: "Products", cols: [treetable] },
				{ id: "Admin", template: "Admin View" }

			]
		};

		webix.ui({
			rows: [toolbar, { cols: [list, main] }, footer],
		}
		);
		$$("list_input").attachEvent("onTimedKeyPress", function () {
			let value = this.getValue().toLowerCase();
			$$("userList").filter(function (obj) {
				return obj.name.toLowerCase().indexOf(value) !== -1;
			})
		});


	</script>
</body>

</html>